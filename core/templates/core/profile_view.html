{% extends 'base.html' %}
{% block content %}
<div style="max-width: 1000px; margin: 0 auto; padding: 20px;">
    <!-- Popup Notifications -->
    <style>
        .popup-notification {
            animation: slideIn 0.5s ease-out;
            transform-origin: top center;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .popup-auto-dismiss {
            position: relative;
            overflow: hidden;
        }
        
        .popup-auto-dismiss::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: rgba(255, 255, 255, 0.5);
            animation: countdown 3s linear forwards;
        }
        
        @keyframes countdown {
            from {
                width: 100%;
            }
            to {
                width: 0%;
            }
        }
        
        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            to {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
        }
    </style>
    
    {% for message in messages %}
        {% if message.message == 'profile_completed' %}
            <div class="popup-notification popup-auto-dismiss" style="
                background: linear-gradient(135deg, #28a745 0%, #20c997 100%); 
                color: white; 
                padding: 15px 20px; 
                margin-bottom: 20px; 
                border-radius: 8px;
                box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
                ">
                <div style="display: flex; align-items: center;">
                    <i class="fas fa-check-circle" style="font-size: 20px; margin-right: 10px;"></i>
                    <div>
                        <strong>Profile Completed! (100%)</strong>
                        <p style="margin: 0; font-size: 14px; opacity: 0.9;">Your profile is now visible to other users in search results!</p>
                    </div>
                </div>
            </div>
        {% elif message.message == 'profile_updated' %}
            <div class="popup-notification popup-auto-dismiss" style="
                background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); 
                color: white; 
                padding: 15px 20px; 
                margin-bottom: 20px; 
                border-radius: 8px;
                box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
                ">
                <div style="display: flex; align-items: center;">
                    <i class="fas fa-edit" style="font-size: 20px; margin-right: 10px;"></i>
                    <div>
                        <strong>Profile Updated!</strong>
                        <p style="margin: 0; font-size: 14px; opacity: 0.9;">Your changes have been saved successfully!</p>
                    </div>
                </div>
            </div>
        {% else %}
            <!-- Generic message popup -->
            <div class="popup-notification popup-auto-dismiss" style="
                background: linear-gradient(135deg, #6c757d 0%, #495057 100%); 
                color: white; 
                padding: 15px 20px; 
                margin-bottom: 20px; 
                border-radius: 8px;
                box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
                ">
                <div style="display: flex; align-items: center;">
                    <i class="fas fa-info-circle" style="font-size: 20px; margin-right: 10px;"></i>
                    <div>
                        <strong>{{ message }}</strong>
                    </div>
                </div>
            </div>
        {% endif %}
    {% endfor %}

    <script>
        // Auto-dismiss popups after 3 seconds
        document.addEventListener('DOMContentLoaded', function() {
            const popups = document.querySelectorAll('.popup-auto-dismiss');
            
            popups.forEach(function(popup) {
                // Start fade out animation after 2.7 seconds (before the 3 second mark)
                setTimeout(function() {
                    popup.style.animation = 'fadeOut 0.3s ease-out forwards';
                }, 2700);
                
                // Remove from DOM after 3 seconds
                setTimeout(function() {
                    if (popup.parentNode) {
                        popup.parentNode.removeChild(popup);
                    }
                }, 3000);
            });
        });
    </script>

    <!-- Name Completion Notification -->
    {% if not profile.user.first_name or not profile.user.last_name %}
        <div style="background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%); color: white; padding: 15px 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <div style="display: flex; align-items: center;">
                    <i class="fas fa-exclamation-circle" style="font-size: 20px; margin-right: 10px;"></i>
                    <div>
                        <strong>Complete Your Profile</strong>
                        <p style="margin: 0; font-size: 14px; opacity: 0.9;">Add your first and last name to help others recognize you</p>
                    </div>
                </div>
                <a href="{% url 'complete_name' %}" style="background: rgba(255,255,255,0.2); color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600; transition: all 0.3s ease; border: 1px solid rgba(255,255,255,0.3);">
                    Complete Now
                </a>
            </div>
        </div>
    {% endif %}

    <!-- Profile Completion Status - Different styles based on severity -->
    {% if completion_status_type == 'critical_missing' %}
        <!-- Red status bar for missing critical fields (name, location) -->
        <div style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; padding: 15px 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <div style="display: flex; align-items: center;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 20px; margin-right: 10px;"></i>
                    <div>
                        <strong>Profile Incomplete ({{ completion_percentage }}%)</strong>
                        <p style="margin: 0; font-size: 14px; opacity: 0.9;">
                            Your profile won't appear in search results. Missing: 
                            {% for field in missing_fields %}
                                {{ field }}{% if not forloop.last %}, {% endif %}
                            {% endfor %}
                        </p>
                    </div>
                </div>
                <a href="{% url 'profile_edit' %}" style="background: rgba(255,255,255,0.2); color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600; transition: all 0.3s ease; border: 1px solid rgba(255,255,255,0.3);">
                    Complete Profile
                </a>
            </div>
        </div>
    {% elif completion_status_type == 'skills_missing' %}
        <!-- Yellow/orange status bar for missing skills only -->
        <div style="background: linear-gradient(135deg, #fd7e14 0%, #ffc107 100%); color: white; padding: 15px 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(253, 126, 20, 0.3);">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <div style="display: flex; align-items: center;">
                    <i class="fas fa-lightbulb" style="font-size: 20px; margin-right: 10px;"></i>
                    <div>
                        <strong>Add Your Skills</strong>
                        <p style="margin: 0; font-size: 14px; opacity: 0.9;">
                            To appear in search results, add skills you can offer or skills you need help with
                        </p>
                    </div>
                </div>
                <a href="{% url 'profile_edit' %}" style="background: rgba(255,255,255,0.2); color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600; transition: all 0.3s ease; border: 1px solid rgba(255,255,255,0.3);">
                    Add Skills
                </a>
            </div>
        </div>
    {% endif %}

    <!-- Basic Info & About Me -->
    <div style="background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); border-radius: 12px; padding: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); margin-bottom: 20px;">
        <h2 style="text-align: center; margin: 0 0 20px 0; color: #333;">
            {% if profile.user.first_name and profile.user.last_name %}
                {{ profile.user.first_name }} {{ profile.user.last_name }}
                <small style="color: #666; font-size: 14px; display: block; margin-top: 5px;">@{{ profile.user.username }}</small>
            {% else %}
                {{ profile.user.username }}
            {% endif %}
        </h2>
        
        <div style="display: flex; gap: 20px; align-items: flex-start;">
            <div style="flex-shrink: 0; position: relative;">
                <a href="{% url 'profile_edit' %}" style="text-decoration: none; display: block; position: relative;" title="Click to edit profile">
                    {% if profile.profile_picture %}
                        <img src="{{ profile.profile_picture.url }}" alt="Profile Picture" style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 3px solid #667eea; transition: all 0.3s ease; cursor: pointer;">
                    {% else %}
                        <div style="width: 150px; height: 150px; border-radius: 50%; background: linear-gradient(135deg, #f0f0f0 0%, #e0e0e0 100%); display: flex; align-items: center; justify-content: center; border: 3px solid #667eea; transition: all 0.3s ease; cursor: pointer;">
                            <i class="fas fa-user" style="font-size: 60px; color: #999;"></i>
                        </div>
                    {% endif %}
                    <div style="position: absolute; top: 0; left: 0; width: 150px; height: 150px; border-radius: 50%; background: rgba(102, 126, 234, 0.8); display: flex; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s ease; color: white; font-weight: bold; font-size: 14px; text-align: center; flex-direction: column;">
                        <i class="fas fa-edit" style="font-size: 24px; margin-bottom: 5px;"></i>
                        <span>Edit Profile</span>
                    </div>
                </a>
                <style>
                    a[title="Click to edit profile"]:hover div:last-child {
                        opacity: 1;
                    }
                    a[title="Click to edit profile"]:hover img,
                    a[title="Click to edit profile"]:hover > div:first-child {
                        transform: scale(1.05);
                        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
                    }
                    
                    .skill-action-btn:hover {
                        background: rgba(255,255,255,0.3) !important;
                        transform: translateY(-2px);
                        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                    }
                </style>
            </div>
            
            <div style="flex: 1;">
                <div style="margin-bottom: 15px;">
                    {% if profile.user.first_name and profile.user.last_name %}
                        <strong style="color: #17a2b8;">Full Name:</strong> {{ profile.user.first_name }} {{ profile.user.last_name }}<br>
                    {% endif %}
                    <strong style="color: #17a2b8;">Username:</strong> {{ profile.user.username }}<br>
                    <strong style="color: #17a2b8;">City:</strong> 
                    {% if profile.city %}
                        {{ profile.city }}
                    {% else %}
                        <span style="color: #999;">Not specified</span>
                    {% endif %}<br>
                    <strong style="color: #17a2b8;">Country:</strong> 
                    {% if profile.country %}
                        {{ profile.country }}
                    {% else %}
                        <span style="color: #999;">Not specified</span>
                    {% endif %}<br>
                    <strong style="color: #17a2b8;">Gender:</strong> 
                    {% if profile.gender %}
                        {{ profile.get_gender_display }}
                    {% else %}
                        <span style="color: #999;">Not specified</span>
                    {% endif %}
                </div>
            </div>
        </div>

        <div style="margin-top: 20px;">
            <h3 style="color: #17a2b8; margin-bottom: 15px;">About me:</h3>
            <div style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; min-height: 60px;">
                {% if profile.bio %}
                    {{ profile.bio }}
                {% else %}
                    <em style="color: #999;">No bio provided yet.</em>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Skills & Feedback -->
    <div style="background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); border-radius: 12px; padding: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.1);">
        <a href="{% url 'my_skills' %}" class="skill-management" style="
            display: block;
            background-image: linear-gradient(109.6deg,  rgba(102,51,153,1) 11.2%, rgba(69,179,224,1) 100.1% );
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
            text-decoration: none;
            font-weight: 700;
            font-size: 1.3rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
            border: none;
            cursor: pointer;
        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(0, 123, 255, 0.4)'; this.style.backgroundImage='linear-gradient(109.6deg,  rgba(68,34,102,1) 11.2%, rgba(34,102,153,1) 100.1% )';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0, 123, 255, 0.3)'; this.style.backgroundImage='linear-gradient(109.6deg,  rgba(102,51,153,1) 11.2%, rgba(69,179,224,1) 100.1% )';">
            <i class="fas fa-tools" style="margin-right: 10px; font-size: 1.4rem;"></i> Manage My Skills
        </a>

        <div style="margin-bottom: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h3 style="color: #17a2b8; margin: 0;">Skills I need help with:</h3>
            </div>
            <div style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; min-height: 80px;">
                {% if profile.skills_needed %}
                    {{ profile.skills_needed }}
                {% else %}
                    <em style="color: #999;">No skills specified yet. <a href="{% url 'skill_create' %}?type=request">Add your first skill request</a></em>
                {% endif %}
            </div>
        </div>

        <div style="margin-bottom: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h3 style="color: #17a2b8; margin: 0;">Skills I can help with:</h3>
            </div>
            <div style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; min-height: 80px;">
                {% if profile.skills_offered %}
                    {{ profile.skills_offered }}
                {% else %}
                    <em style="color: #999;">No skills specified yet. <a href="{% url 'skill_create' %}?type=offer">Add your first skill offering</a></em>
                {% endif %}
            </div>
        </div>

        <div>
            <h3 style="color: #17a2b8; margin-bottom: 15px;">Feedback received</h3>
            <div style="background-color: #f8f9fa; padding: 15px; border-radius: 5px;">
                <div style="margin-bottom: 10px;">
                    <strong>Overall</strong>
                    <div style="color: #ffc107; font-size: 18px;">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                    </div>
                </div>
                <div style="color: #666; font-size: 14px;">
                    <strong>Completed SkillSwaps:</strong> 0
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

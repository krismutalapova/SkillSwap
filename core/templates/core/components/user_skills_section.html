{% load rating_extras %}

<!-- User Skills Component -->
<div class="user-skills">
    <div class="skills-header">
        <h3><i class="fas fa-tools"></i> {{ section_title|default:"My Skills" }}</h3>
        {% if show_add_button %}
            <a href="{% url 'add_skill' %}?next={{ next_page|default:'view_my_profile' }}" class="primary-gradient add-skill-btn">
                <i class="fas fa-plus"></i> Add New Skill
            </a>
        {% endif %}
    </div>
    
    <div class="skills-container">
        <!-- Skills Offered -->
        {% if offered_skills %}
            <div class="{% if use_card_layout %}skills-section{% else %}compact-skills-section{% endif %}">
                <h4><i class="fas fa-hand-holding-heart"></i> 
                    {% if is_own_profile %}
                        Skills I Offer ({{ offered_skills.count }})
                    {% else %}
                        Skills {{ user_name|default:"User" }} Offers ({{ offered_skills.count }})
                    {% endif %}
                </h4>
                {% if use_card_layout %}
                    <div class="profile-skills-grid">
                        {% for skill in offered_skills %}
                            <a href="{% url 'skill_detail_page' skill.pk %}" class="skill-card-link">
                                <div class="skill-card offer">
                                    <div class="skill-header">
                                        <h4 class="skill-title">{{ skill.title }}</h4>
                                        <span class="skill-type offer">
                                            <i class="fas fa-hand-holding-heart"></i> Offering
                                        </span>
                                    </div>
                                    <div class="skill-content">
                                        <p class="skill-description">{{ skill.description|truncatechars:120 }}</p>
                                        <div class="skill-meta">
                                            <span class="category">
                                                <i class="fas fa-tag"></i>
                                                {{ skill.get_category_display }}
                                            </span>
                
                                            {% if skill.average_rating > 0 %}
                                                <div class="rating-display">
                                                    {% star_rating skill.average_rating show_value=False show_count=False %}
                                                    <span class="rating-text">({{ skill.rating_count }})</span>
                                                </div>
                                            {% endif %}
                                        </div> 
                                         <div class="skill-footer">
                                            {% if skill.availability %}
                                            <span class="skill-availability">
                                                <i class="fas fa-clock"></i>
                                                {{ skill.availability }}
                                            </span>
                                            {% else %}
                                            <span class="skill-availability">
                                                <i class="fas fa-clock"></i>
                                                {% if skill.is_active %}Available{% else %}Not available{% endif %}
                                            </span>
                                            {% endif %}
                                            {% if skill.is_remote %}
                                                <span class="remote-tag">
                                                    <i class="fas fa-wifi"></i> Remote Available
                                                </span>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </a>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="compact-skills-tiles">
                        {% for skill in offered_skills %}
                            <div class="compact-skill-tile offer">
                                <a href="{% url 'skill_detail_page' skill.pk %}" class="compact-skill-tile-link">
                                    <div class="compact-skill-tile-content">
                                        <i class="fas fa-hand-holding-heart"></i>
                                        <span class="compact-skill-title">{{ skill.title }}</span>
                                        <span class="compact-skill-category">{{ skill.get_category_display }}</span>
                                    </div>
                                </a>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        {% endif %}

        <!-- Skills Requested -->
        {% if requested_skills %}
            <div class="{% if use_card_layout %}skills-section{% else %}compact-skills-section{% endif %}">
                <h4><i class="fas fa-search"></i> 
                    {% if is_own_profile %}
                        Skills I Need ({{ requested_skills.count }})
                    {% else %}
                        Skills {{ user_name|default:"User" }} Needs ({{ requested_skills.count }})
                    {% endif %}
                </h4>
                {% if use_card_layout %}
                    <div class="profile-skills-grid">
                        {% for skill in requested_skills %}
                            <a href="{% url 'skill_detail_page' skill.pk %}" class="skill-card-link">
                                <div class="skill-card request">
                                    <div class="skill-header">
                                        <h4 class="skill-title">{{ skill.title }}</h4>
                                        <span class="skill-type request">
                                            <i class="fas fa-search"></i> Looking for
                                        </span>
                                    </div>
                                    <div class="skill-content">
                                        <p class="skill-description">{{ skill.description|truncatechars:120 }}</p>
                                        <div class="skill-meta">
                                            <span class="category">
                                                <i class="fas fa-tag"></i>
                                                {{ skill.get_category_display }}
                                            </span>
                
                                            {% if skill.average_rating > 0 %}
                                                <div class="rating-display">
                                                    {% star_rating skill.average_rating show_value=False show_count=False %}
                                                    <span class="rating-text">({{ skill.rating_count }})</span>
                                                </div>
                                            {% endif %}
                                        </div> 
                                         <div class="skill-footer">
                                            {% if skill.availability %}
                                            <span class="skill-availability">
                                                <i class="fas fa-clock"></i>
                                                {{ skill.availability }}
                                            </span>
                                            {% else %}
                                            <span class="skill-availability">
                                                <i class="fas fa-clock"></i>
                                                {% if skill.is_active %}Available{% else %}Not available{% endif %}
                                            </span>
                                            {% endif %}
                                            {% if skill.is_remote %}
                                                <span class="remote-tag">
                                                    <i class="fas fa-wifi"></i> Remote Available
                                                </span>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </a>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="compact-skills-tiles">
                        {% for skill in requested_skills %}
                            <div class="compact-skill-tile request">
                                <a href="{% url 'skill_detail_page' skill.pk %}" class="compact-skill-tile-link">
                                    <div class="compact-skill-tile-content">
                                        <i class="fas fa-search"></i>
                                        <span class="compact-skill-title">{{ skill.title }}</span>
                                        <span class="compact-skill-category">{{ skill.get_category_display }}</span>
                                    </div>
                                </a>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        {% endif %}

        <!-- Empty State -->
        {% if not offered_skills and not requested_skills %}
            <div class="no-skills">
                <div class="no-skills-icon">
                    <i class="fas fa-info-circle"></i>
                </div>
                <p>{% if empty_message %}{{ empty_message }}{% elif user_display_name %}{{ user_display_name }} hasn't added any skills yet.{% else %}You haven't added any skills yet.{% endif %}</p>
                {% if show_empty_actions %}
                    <div class="empty-actions">
                        <a href="{% url 'add_skill' %}?type=offer&next={{ next_page|default:'view_my_profile' }}" class="{% if use_gradient_button %}primary-gradient {% endif %}primary-btn">
                            <i class="fas fa-plus"></i> Offer a Skill
                        </a>
                        <a href="{% url 'add_skill' %}?type=request&next={{ next_page|default:'view_my_profile' }}" class="secondary-btn">
                            <i class="fas fa-search"></i> Request a Skill
                        </a>
                    </div>
                {% endif %}
            </div>
        {% endif %}
    </div>
</div>
